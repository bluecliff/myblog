Date: 2013-6-12 12:12
tags: wifi
title: wifi通信简介
md_linebreaks: two


wifi简介
=========

wifi(wireless fidelity(无线保真))通信通常指的是802.11标准下的短距离无线通讯技术，它是当前应用最为广泛的WLAN标准。在当前环境下使用最多的是2.4GHZ频段的802.11b和802.11g标准。通常意义上的wifi即指这两个标准，802.11b支持最大11Mbps的通讯速率，802.11g支持最大54Mbps的通信速率。目前5GHZ的802.11a标准已经有一些应用，最大支持的速率是54Mbps,但尚未普及。本文档之后所提到的wifi技术都是指802.11g标准通信技术。

wifi信道
=========

802.11b和802.11g标准工作在2.4GHZ下，标准总共有14个信道，中国大陆开放可用的是1到13信道，14信道禁止使用。信道具体分布如图所示。

![](/images/Wi-Fi_channels.png)

无线网卡的工作方式
===================

无线网卡可以工作在多种模式之下。常见的有Master，Managed，ad-hoc，monitor等模式。

Master模式是无线AP和路由器的工作模式，在这种模式下，无线路由广播beacon frame。通常包括AP工作的频段，SSID，MAC等信息。

Managed模式即一般的wifi客户端设备，如手机，笔记本等无线设备的工作模式，该模式下网卡会主动发出probe request frame，包括手机的MAC等信息。

ad-hoc模式是点对点的连接方式，用于在两台无线设备之间传送信息。

monitor模式即监听模式，该模式下网卡可以接收到所有它能够接收的无线电信号并试图进行解析，而不仅仅局限于它所连接的无线局域网。

几个名词
=========

- BSS basic service set。基本服务集，提供基本的wlan服务的集合。最简单的情况是一个ap加一个接入该ap的无线设备。此时这个ap即控制着接入这个BSS的所有设备。

- BSSID BSS的ID号，表示一个基本的服务集的名称，只对应于一个BSS。BSSID由BSS管理，是动态生成的一个48位的MAC。若48位全为1，则这个BSSID只在probe request请求中使用。

- ESS extended service set，指的是一个或者多个BSS组成的互联的服务集。

- SSID 等同于ESSID，标示一个ESS的id。用户可配置，并且ESS的所有BSS统一对外广播的网络名称，client发起连接时采用的名称。


802.11认证过程
===============

首先介绍几个概念：

- 信标（beacon）：AP用于表明一个无线网络的存在。包含SSID、支持的速率及安全设置。目的是为了让客户端知道在一定的区域内有哪些网络及哪些AP，以便客户端选择哪个网络及哪个AP。SSID往往被一些厂商建议用“不广播”来实现安全的作用。事实上这种安全措施作用甚微，因为黑客可在关联阶段侦知到SSID。从可操作性及客户端支持性上看，最好允许SSID广播。

- 探针（probe）：客户端探查无线网络。无线网卡在多个信道中发送探针请求，搜索某个网络。一个典型的客户端其探针中往往会包含某个网络的SSID，这使得SSID很容易被黑客侦知；如果一个客户端想知道所有可用网络，它可以发送一个不含SSID的探针请求，这样所有AP都会响应，除非设置了“不广播”SSID。搜索特定网络的探针请求同样包含SSID、支持的速率及安全配置这些要素，与AP广播的信号一致。

- 认证（authentication）：采用802.11网络标准。802.11一开始开发了两种论证机制：开放式认证和共享WEP密钥式认证。开放式认证是其实是一个“空认证”，即：客户端说“我来了”，AP说“请进吧”。空认证不是无认证，它也有一问一答，也是一个认证过程；共享WEP密钥式认证则在客户端和AP端预设密钥进式认证。这种方式有很大的缺陷，在很多场合已不建议采用。因此企业真实环境下采用的论证方式是802.1X/EAP认证机制，即802.11i认证。

- 关联（asociation）：客户端与AP建立数据链路连接。这个过程 确定安全机制及传输速率，建立数据链路。

无线用户首先需要通过主动/被动扫描发现周围的无线服务，再通过认证和关联两个过程后，才能和AP建立连接，最终接入无线局域网。

无线客户端有两种方式可以获取到周围的无线网络信息：一种是被动扫描，无线客户端只是通过监听周围AP发送的Beacon（信标帧）获取无线网络信息；另外一种为主动扫描，无线客户端在扫描的时候，同时主动发送一个探测请求帧（Probe Request帧），通过收到探查响应帧（Probe Response）获取网络信号。
无线客户端在实际工作过程中，通常同时使用被动扫描和主动扫描获取周围的无线网络信息。
 
(1) 主动扫描
 
无线客户端工作过程中，会定期地搜索周围的无线网络，也就是主动扫描周围的无线网络。根据Probe Request帧（探测请求帧）是否携带SSID，可以将主动扫描分为两种：
 
客户端发送Probe Request帧（SSID为空，也就是SSID IE的长度为0）：客户端会定期地在其支持的信道列表中，发送探查请求帧（Probe Request）扫描无线网络。当AP收到探查请求帧后，会回应探查响应帧（Probe Response）通告可以提供的无线网络信息。无线客户端通过主动扫描，可以主动获知可使用的无线服务，之后无线客户端可以根据需要选择适当的无线网络接入。
 
客户端发送Probe Request（Probe Request携带指定的SSID）：当无线客户端配置希望连接的无线网络或者已经成功连接到一个无线网络情况下，客户端也会定期发送探查请求帧（Probe Request）(该报文携带已经配置或者已经连接的无线网络的SSID)，当能够提供指定SSID无线服务的AP接收到探测请求后回复探查响应。通过这种方法，无线客户端可以主动扫描指定的无线网络。
 
(2)  被动扫描
 
被动扫描是指客户端通过侦听AP定期发送的Beacon帧发现周围的无线网络。提供无线网络服务的AP设备都会周期性发送Beacon帧，所以无线客户端可以定期在支持的信道列表监听信标帧获取周围的无线网络信息。当用户需要节省电量时，可以使用被动扫描。一般VoIP语音终端通常使用被动扫描方式。


认证过程如下所示：

![](/images/802.11auth.png)
